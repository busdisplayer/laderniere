<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Countdown jusqu'à La Dernière - Radio Nova</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        h1 {
            font-size: 2.5rem;
            color: #3498db;
        }
        #countdown {
            font-size: 2rem;
            margin: 20px 0;
        }
        #novaPlayer {
            margin-top: 30px;
        }
    </style>
</head>
<body>

    <h1>La Dernière - Radio Nova</h1>
    <div id="countdown">Chargement du countdown...</div>

    <!-- Div pour afficher le lecteur -->
    <div id="novaPlayer"></div>

    <script>
        // Fonction pour calculer le temps restant jusqu'à dimanche 18h
        function getNextSunday18h() {
            const now = new Date();
            const dayOfWeek = now.getDay();  // 0 = Dimanche, 6 = Samedi
            const distanceToSunday = 7 - dayOfWeek;
            const nextSunday = new Date(now.getFullYear(), now.getMonth(), now.getDate() + distanceToSunday, 18, 0, 0);
            if (nextSunday <= now) {
                // Si c'est déjà passé, on ajoute 7 jours
                nextSunday.setDate(nextSunday.getDate() + 7);
            }
            return nextSunday;
        }

        // Mettre à jour le countdown toutes les secondes
        function updateCountdown() {
            const now = new Date();
            const targetDate = getNextSunday18h();
            const distance = targetDate - now;

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            document.getElementById('countdown').innerHTML =
                days + "j " + hours + "h " + minutes + "m " + seconds + "s ";

            // Si c'est dimanche entre 18h et 20h, afficher le lecteur
            const isSunday = (now.getDay() === 0);
            const currentHour = now.getHours();
            if (isSunday && currentHour >= 18 && currentHour < 20) {
                document.getElementById('novaPlayer').innerHTML = `
                    <div id="wrFXMzUlw7XDpcOZw7xNMcKnVncmMjfDpXjDrsOu" class="mytuner-widget" data-placeholder="https://www.radio-en-ligne.fr/static/icons/widgets/radiologo/generic/radio_dark.png" data-target="399424" data-requires_initialization="true" data-autoplay="true" data-hidehistory="true" style="width: 100%; max-width: 100%; overflow: hidden; max-height: 500px; border: 1px solid rgb(129, 127, 128); border-radius: 6px;"></div>
                    <script>
                        var widget_id = widget_id || "wrFXMzUlw7XDpcOZw7xNMcKnVncmMjfDpXjDrsOu";
                        var mytuner_scripts = mytuner_scripts || {};
                        mytuner_scripts["player-v1.js_queue"] = mytuner_scripts["player-v1.js_queue"] || [];
                        if (mytuner_scripts["player-v1.js-imported"] == undefined) {
                            mytuner_scripts["player-v1.js-imported"] = false;
                            mytuner_scripts["player-v1.js"] = function(){};
                            var s = document.createElement("script");
                            s.type = "text/javascript";
                            s.src = "https://mytuner-radio.com/static/js/widgets/player-v1.js";
                            s.defer = true;
                            if (s.readyState) {
                                s.onreadystatechange = function(){
                                    if (s.readyState == "loaded" || s.readyState == "complete") {
                                        s.onreadystatechange = null;
                                        runQueue();
                                    }
                                };
                            } else {
                                s.onload = function(){ runQueue(); };
                            }
                            document.getElementsByTagName('head')[0].appendChild(s);
                            
                            function runQueue() {
                                mytuner_scripts["player-v1.js_queue"].forEach(function(func) {
                                    func();
                                });
                            }
                            mytuner_scripts["player-v1.js_queue"].push(function(){mytuner_scripts["player-v1.js"]("wrFXMzUlw7XDpcOZw7xNMcKnVncmMjfDpXjDrsOu")});
                        } else {
                            let widget = document.getElementById("wrFXMzUlw7XDpcOZw7xNMcKnVncmMjfDpXjDrsOu");
                            if (widget && widget.dataset.requires_initialization === "true") {
                                if (mytuner_scripts["player-v1.js-imported"]) {
                                    mytuner_scripts["player-v1.js"]("wrFXMzUlw7XDpcOZw7xNMcKnVncmMjfDpXjDrsOu");
                                    widget.dataset.requires_initialization = "false";
                                } else {
                                    mytuner_scripts["player-v1.js_queue"].push(function(){
                                        mytuner_scripts["player-v1.js"]("wrFXMzUlw7XDpcOZw7xNMcKnVncmMjfDpXjDrsOu");
                                        widget.dataset.requires_initialization = "false";
                                    });
                                }
                            }
                        }
                    </script>
                `;
            } else {
                document.getElementById('novaPlayer').innerHTML = "";
            }

            // Si le countdown est terminé, recommencer pour le prochain dimanche
            if (distance < 0) {
                clearInterval(countdownInterval);
                updateCountdown(); // Relancer pour la prochaine semaine
            }
        }

        // Lancer la mise à jour du countdown toutes les secondes
        const countdownInterval = setInterval(updateCountdown, 1000);
    </script>

</body>
</html>
